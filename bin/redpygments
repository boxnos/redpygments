#!/usr/bin/env ruby
require 'redpygments'
require 'optparse'
require 'slim'

option = {
  template: nil,
  output: nil
}
opt = OptionParser.new

opt.on('-d', '--default', 'use default template') {|v| option[:template] = Redpygments::default_template}
opt.on('-s file', '--slim file', 'slim template') {|v| option[:template] = v}
opt.on('-o file', '--output file', 'output file') {|v| option[:output] = v}

opt.parse! ARGV


if ARGV.empty?
  lines = ""
  while line = gets
    lines += line
  end
  inner_html = Redpygments.parse_markdown(lines)
else
  inner_html = ""
  ARGV.each do |f|
    inner_html += Redpygments.parse_markdown(open(f).read)
  end
end

if option[:template]
  html = Redpygments.parse_slim(option[:template], inner_html, pretty: true)
else
  html = inner_html
end

html += "\n"

if option[:output]
  File.open(option[:output], "w").write html
else
  print html
end

# vim: set ft=ruby:
